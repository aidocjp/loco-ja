+++
title = "Data"
description = ""
date = 2024-02-07T08:00:00+00:00
updated = 2024-02-07T08:00:00+00:00
draft = false
weight = 4
sort_by = "weight"
template = "docs/page.html"

[extra]
lead = ""
toc = true
top = false
flair =[]
+++

`Loco`はシンプルな静的データローダー機能を提供します。これは以下のようなケースで便利です：

* JSONファイルから読み込む必要がある読み取り専用データへのアクセスが必要な場合
* 外部ソースから定期的にデータをダウンロードし、プロセスで使用したい場合（更新するには通常、プロセスを再起動するか、ディスクから直接読み取ります）


例：

* 機械学習モデルのハイパーパラメータ（時々更新されるもの）
* IPバンリスト
* カレンダー関連のイベント
* 株式データ
* セキュリティポリシー
* コンテナごとのポリシーまたは設定

## 新しいデータローダーの作成

`data`ジェネレーターを使用します：

```
$ cargo loco g data stocks
added: "data/stocks/data.json"
added: "src/data/stocks.rs"
injected: "src/data/mod.rs"
* Data loader `Stocks` was added successfully.
```

実際のデータは、新しい`data/`フォルダー（`src/`の隣）に配置する必要があります。これは設定が`config/`に配置されるのと同様です。ここでは、JSONデータファイルは`data/stocks/data.json`という名前になっています。

データ_モジュール_は追加された`src/data/stocks.rs`モジュール内にあり、コードのどこからでも静的に利用できる新しい`crate::data::stocks`名前空間を作成します。

データを読み込むには、アプリの_バイナリ_がその隣に`data/`フォルダーを見つける必要があることに注意してください。このフォルダーの名前をカスタマイズしたい場合は、`LOCO_DATA`環境変数を設定できます。

## データ構造の定義

`src/data/stocks.rs`ファイルには、自動生成されたデータの初期定義が含まれています：

```
#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct Stocks {
    pub is_loaded: bool,
}
```

実際のデータを`data/stocks/data.json`に配置する際は、`Stocks`構造体でデータの_形状_を一致させるように定義する必要があります（[quicktype](https://quicktype.io/)のようなツールを使って自動的に行うこともできます）。`serde`対応のデータ型であれば何でも使用できます。


## 静的データの使用

`data::stocks::get()`をどこからでも使用して、プロセスの存続期間中に**一度**だけ読み込まれるデータにアクセスできます（これはデータのメモリ内イメージを使用します）。`get()`は何度でも呼び出すことができ、特別なパフォーマンスコストはかかりません。

`data::stocks::read()`を使用してディスクから直接読み取ることもできます（注意：これは呼び出しごとにIO時間を消費します）。

## プロセスデータの更新

このデータはプロセスの存続期間中に**一度**だけ読み込まれるため、効果的に更新するにはプロセスを再起動する必要があります。

`data`サブシステムでは、これらのタイプのデータの使用ケースは更新よりもはるかに多く読み取られることを想定しています（ただし、時々更新されます）。したがって、これは読み取り集約的な使用ケースであり、_頻繁に_更新されるデータには別のストレージパラダイム（キャッシュ、データベースなど）が必要です。データのメモリ内コピーは、他の静的データと同様に、可能な限り最高の読み取りアクセスパフォーマンスを提供します。

このデータを更新する必要がある場合、Locoプロセスの再起動は_高速_であり、概念的には新しいバージョンのデプロイに似ていますが、新しいコードをデプロイしないため時間と労力を節約できます。

また、`read()`関数を使用してディスクから読み取り、どこか中央にキャッシュすることもできます（Locoの`cache`システムを使用できます）。
